{
    "version": "https://jsonfeed.org/version/1",
    "title": "Malachi Reynolds",
    "home_page_url": "http://localhost:4000/",
    "feed_url": "http://localhost:4000/feed.json",
    "description": "Hi, this is a simple blog about my passion projects and learning experiences that I want to share with everyone! Thanks for checking it out!",
    "icon": "http://localhost:4000/apple-touch-icon.png",
    "favicon": "http://localhost:4000/favicon.ico",
    "expired": false,
    
    "author":  {
        "name": "Malachi",
        "url": null,
        "avatar": null
    },
    
"items": [
    
        {
            "id": "http://localhost:4000/2024/01/11/flash-9300-8i-raid-controller-to-it-mode",
            "title": "Flash 9300 8i Raid Controller To It Mode",
            "summary": null,
            "content_text": "A 9340-8i was used for this guide. Likely also compatible with IBM/Lenovo M1215 and SAS 3008 models, but have not tested them. This is not a guide for flashing to IR mode or from IR mode to IT mode.This is an updated guide on how to flash IT mode firmware to your LSI/Avago/Broadcom 9300-8i RAID Controller. It is largely based on this tutorial from 2016. Most of the screenshots and techniques used in this guide are from that tutorial and others, but this repo compiles them, includes additional updated information/commentary, and makes all of the files used easily accessible.Why would I want to flash my RAID controller?There are multiple reasons why you may want to flash your RAID controller to make it a Host Bus Adapter (HBA):  Using software RAID or filesystems including ZFS and BTRFS  Avoiding RAID Limitations/CompatibilityBenefits of Using an HBA(Video) RAID vs HBA SAS controllers(Video) Hardware RAID Is DeadWarning: Before proceeding, do note that this is a risky process. Issues with firmware flashes can render your card “bricked” and unusable/unrecoverable. I will not be held responsible if this happens to your card. By following this guide, you accept all risks of damaging your card.Required Items  Circuit Board Jumper Pin  USB Flash Drive  Rufus Software  Firmware Files (located in this repo)1. Getting the FilesDownload all five of these files from this repo and put them on a USB drive. They are necessary for this guide.  bootx64.efi         :       UEFI Shell Boot File  mptsas3.rom         :       Legacy BIOS OROM  mpt3x64.rom         :       UEFI BIOS OROM  sas3flash.efi       :       Flashing tool  Note: Other tutorials aimed at flashing older models including 9200 models may use sas2flash.efi instead. The 9300 does not work with sas2flash.efi and requires sas3flash.efi.  SAS9300_8i_IT.bin   :       IT Mode Firmware  Note: Sometimes there can be trouble with using the “” and “Shift” keys while in the UEFI shell. If any problems occur, change the name of this file to something without those characters and retry, adjusting the following commands accordingly.2. Preparing the USB Drive  To access the UEFI shell later on with the required files, you must format your USB flash drive into a bootable Free-DOS drive using Rufus. Launch Rufus, select the correct drive under “Device”, select “Free-DOS” under “Boot Selection”, and click “Start”. This should only take a couple seconds.   WARNING: ALL FILES ON THE SELECTED DRIVE WILL BE DELETED.     After the drive has completed formatting to Free-DOS, create a folder on the root of the USB named “EFI”.  Inside that folder, create another folder named “Boot”.  Move the bootx64.efi file into the “Boot” folder. (Resulting filepath is EFI/Boot/bootx64.efi)  Now add all required files from this repo to the root of the USB.   Resulting filesystem after formatting drive in Rufus and adding the required files.   3. Preparing the Adapter      Put the jumper pin on the RAID controller pins. Make sure to put them on the correct pins as there may be multiple to choose from.      Note: I have seen several tutorials claim that this is not necessary. In my testing, however, I have not had success when using their methods, so this tutorial follows the approach of using a jumper pin. If you attempt to do it that way, please note that you must use slightly different commands. If you do not have success with that tutorial, you can fix it by beginning this guide from the beginning.    DO NOT TAKE THE JUMPER PIN OFF UNTIL AFTER THE SYSTEM POWERS DOWN AT THE END OF SECTION 5.               Record the SAS Address of the controller. DO THIS NOW. This may involve taking apart the RAID controller in case it is hidden. However, that should only require a Phillips screwdriver. The sticker should look like this:         4. Booting the Server into UEFI Shell  Before powering on the machine, unplug any external drives that are on the system. This is not necessary, but it may make the process easier later.  Next, plug in the USB drive.      Access the BIOS/UEFI menu to make sure you can boot to the UEFI shell from this USB drive. This can be done through several ways, depending on your system’s manufacturer, as well as the operating system or lack there of. It can usually be triggered by spamming a function key during startup.      - This article includes UEFI/BIOS keys for popular brands, as well as Windows and Linux specific ways to access the UEFI menu.        Enable the system to boot to the drive in BIOS. Once again these settings vary depending on manufacturer.      - “Secure Boot” to “Disabled”      - “Boot Mode” from “Legacy” to “UEFI” or “Auto”    Note: On my system, a Lenovo ThinkServer, this setting was found under “Boot Manager” then “Boot Mode”. Again, manufacturer specific. THIS MAY NOT BE AVAILABLE OR NECESSARY ON ALL SYSTEMS.    Save these changes and restart the system.  Boot to the USB drive. If possible, you can access the boot menu during startup similarly to the BIOS menu. However, you can also go back to the BIOS menu and change the boot sequence to make the UEFI USB Drive the first device the system boots to upon startup. You will now be able to boot to the USB.5. Resetting the Adapter  You should find yourself at a Shell&gt; command line prompt. If you are experienced with using the terminal or are adventerous, here are some interesting commands you can play around with while in this shell.  Now, to find all available drives on the system, type map. This may already show up when you are first brought into the shell.  Your USB drive should be named something along the lines of “Removable Hard Disk”. If not, choose the first drive that shows up first. Mount to the alias of that drive. For example, if the drive is named fs0, type fs0: (remember the colon). Your terminal prompt should now read fs0:\\&gt; as you have successfully mounted the drive.  Type dir to see the filesystem on that drive (Equivalent of using ls in Linux.). If you do not see the files you put on the USB drive, retry the previous commands beginning with map until you find the correct drive.      Type: sas3flash.efi -list        - This shows the SAS Address as mentioned earlier. Record the SAS Address if you haven’t already.    You may get an error stating “Controller is not operational. A firmware download is required.” Type quit to exit that prompt and continue with this guide.             Type this command: sas3flash.efi -f SAS9300_8i_IT.bin -noreset. After it completes, power down the system and take the jumper pin off of the RAID controller.    - This erases the running flash/BIOS on the RAID controller.        6. Flashing the Controller  Boot back into the UEFI shell through the USB drive.  Type this command: sas3flash.efi -o -e 7          Erases the card’s NVRAM             Next, type: sas3flash.efi -f SAS9300_8i_IT.bin -b mptsas3.rom -b mpt3x64.rom          This flashes the new UEFI and Legacy BIOS firmware with ROM             Type: sas3flash.efi -o -sasadd XXXXXXXXXXXXXXXXX          Here, replace the X’s with your SAS Address. DO NOT USE HYPENS, SPACES, ETC.      This  flashes the SAS Address back onto the HBA             Lastly, type this command:sas3flash.efi -list          Verify that all information including the SAS Address are correct.      6. Complete!  You are now able to reboot the system and have completed this guide.      - Command in UEFI shell: resetResources  MAIN TUTORIAL - How to flash a LSI SAS 3008 HBA (e.g. IBM M1215) to IT mode - ServeTheHome Forum  Crossflashing of LSI 9341-8i to LSI 9300-8i - ServeTheHome Forum  Detailed newcomers’ guide to crossflashing LSI 9211/9300/9305/9311/9400/94xx HBA and variants - TrueNAS Forum  [HOW-TO] Flashing LSI SAS HBA Controller [EFI/UEFI] - TrueNAS Forum  Older Card Versions - LSI SAS 2008 RAID Controller/HBA Information - ServeTheHome Forum",
            "content_html": "<p>A 9340-8i was used for this guide. Likely also compatible with IBM/Lenovo M1215 and SAS 3008 models, but have not tested them. This is not a guide for flashing to IR mode or from IR mode to IT mode.</p><p>This is an updated guide on how to flash IT mode firmware to your LSI/Avago/Broadcom 9300-8i RAID Controller. It is largely based on <a href=\"https://www.servethehome.com/flash-lsi-sas-3008-hba-e-g-ibm-m1215-mode/\">this tutorial</a> from 2016. Most of the screenshots and techniques used in this guide are from that tutorial and <a href=\"#resources\">others</a>, but this repo compiles them, includes additional updated information/commentary, and makes all of the files used easily accessible.</p><h2 id=\"why-would-i-want-to-flash-my-raid-controller\">Why would I want to flash my RAID controller?</h2><p>There are multiple reasons why you may want to flash your RAID controller to make it a Host Bus Adapter (HBA):</p><ul>  <li>Using software RAID or filesystems including <a href=\"https://itsfoss.com/what-is-zfs/\" title=\"What is ZFS? - It's FOSS\">ZFS</a> and <a href=\"https://itsfoss.com/btrfs/\" title=\"What is BTRFS - It's FOSS\">BTRFS</a></li>  <li>Avoiding RAID Limitations/Compatibility</li></ul><p><a href=\"https://www.truenas.com/community/resources/whats-all-the-noise-about-hbas-and-why-cant-i-use-a-raid-controller.139/\">Benefits of Using an HBA</a></p><p><a href=\"https://youtu.be/xEbQohy6v8U\">(Video) RAID vs HBA SAS controllers</a></p><p><a href=\"https://www.youtube.com/watch?v=l55GfAwa8RI\">(Video) Hardware RAID Is Dead</a></p><p><strong>Warning: Before proceeding, do note that this is a risky process. Issues with firmware flashes can render your card “bricked” and unusable/unrecoverable. I will not be held responsible if this happens to your card. By following this guide, you accept all risks of damaging your card.</strong></p><h2 id=\"required-items\">Required Items</h2><ul>  <li>Circuit Board Jumper Pin</li>  <li>USB Flash Drive</li>  <li><a href=\"https://rufus.ie/en/\" title=\"Rufus\">Rufus Software</a></li>  <li>Firmware Files (located in this repo)</li></ul><h2 id=\"1-getting-the-files\">1. Getting the Files</h2><p>Download all five of these files from this repo and put them on a USB drive. They are necessary for this guide.</p><ul>  <li>bootx64.efi         :       UEFI Shell Boot File</li>  <li>mptsas3.rom         :       Legacy BIOS OROM</li>  <li>mpt3x64.rom         :       UEFI BIOS OROM</li>  <li>sas3flash.efi       :       Flashing tool</li></ul><p>  <em>Note: Other tutorials aimed at flashing older models including 9200 models may use sas2flash.efi instead. The 9300 does not work with sas2flash.efi and requires sas3flash.efi.</em></p><ul>  <li>SAS9300_8i_IT.bin   :       IT Mode Firmware</li></ul><p>  <em>Note: Sometimes there can be trouble with using the “</em>” and “Shift” keys while in the UEFI shell. If any problems occur, change the name of this file to something without those characters and retry, adjusting the following commands accordingly.</p><h2 id=\"2-preparing-the-usb-drive\">2. Preparing the USB Drive</h2><ol>  <li>To access the UEFI shell later on with the required files, you must format your USB flash drive into a bootable Free-DOS drive using Rufus. Launch Rufus, select the correct drive under <strong>“Device”</strong>, select <strong>“Free-DOS”</strong> under <strong>“Boot Selection”</strong>, and click <strong>“Start”</strong>. This should only take a couple seconds.</li></ol><h4 id=\"-warning-all-files-on-the-selected-drive-will-be-deleted\">   WARNING: ALL FILES ON THE SELECTED DRIVE WILL BE DELETED.</h4><p>   <img src=\"/assets/images/rufus.png\" alt=\"Rufus Free-DOS\" /></p><ol>  <li>After the drive has completed formatting to Free-DOS, create a folder on the root of the USB named “EFI”.</li>  <li>Inside that folder, create another folder named “Boot”.</li>  <li>Move the bootx64.efi file into the “Boot” folder. <strong>(Resulting filepath is EFI/Boot/bootx64.efi)</strong></li>  <li>Now add all required files from this repo to the root of the USB.</li></ol><h4 id=\"-resulting-filesystem-after-formatting-drive-in-rufus-and-adding-the-required-files\">   Resulting filesystem after formatting drive in Rufus and adding the required files.</h4><p>   <img src=\"/assets/images/USB.png\" alt=\"USB Files\" /></p><h2 id=\"3-preparing-the-adapter\">3. Preparing the Adapter</h2><ol>  <li>    <p>Put the jumper pin on the RAID controller pins. Make sure to put them on the correct pins as there may be multiple to choose from.</p>    <p>  <em>Note: I have seen several tutorials claim that this is not necessary. In my testing, however, I have not had success when using their methods, so this tutorial follows the approach of using a jumper pin. If you attempt to do it <a href=\"https://www.truenas.com/community/threads/how-to-flashing-lsi-sas-hba-controller-efi-uefi.78457/\">that way</a>, please note that you must use slightly different commands. If you do not have success with that tutorial, you can fix it by beginning this guide from the beginning.</em></p>    <h3 id=\"do-not-take-the-jumper-pin-off-until-after-the-system-powers-down-at-the-end-of-section-5\">DO NOT TAKE THE JUMPER PIN OFF UNTIL AFTER THE SYSTEM POWERS DOWN AT THE END OF SECTION 5.</h3>    <p>   <img src=\"/assets/images/jumper.jpg\" alt=\"Jumper Pin\" /></p>  </li>  <li>    <p>Record the SAS Address of the controller. DO THIS NOW. This may involve taking apart the RAID controller in case it is hidden. However, that should only require a Phillips screwdriver. The sticker should look like this:</p>    <p>   <img src=\"/assets/images/sasaddress.jpg\" alt=\"SAS Address Sticker\" /></p>  </li></ol><h2 id=\"4-booting-the-server-into-uefi-shell\">4. Booting the Server into UEFI Shell</h2><ol>  <li>Before powering on the machine, unplug any external drives that are on the system. This is not necessary, but it may make the process easier later.</li>  <li>Next, plug in the USB drive.</li>  <li>    <p>Access the BIOS/UEFI menu to make sure you can boot to the UEFI shell from this USB drive. This can be done through several ways, depending on your system’s manufacturer, as well as the operating system or lack there of. It can usually be triggered by spamming a function key during startup.</p>    <p>  - <a href=\"https://www.tomshardware.com/reviews/bios-keys-to-access-your-firmware,5732.html\">This article</a> includes UEFI/BIOS keys for popular brands, as well as Windows and Linux specific ways to access the UEFI menu.</p>  </li>  <li>    <p>Enable the system to boot to the drive in BIOS. Once again these settings vary depending on manufacturer.</p>    <p>  - “Secure Boot” to “Disabled”</p>    <p>  - “Boot Mode” from “Legacy” to “UEFI” or “Auto”</p>    <p><em>Note: On my system, a Lenovo ThinkServer, this setting was found under “Boot Manager” then “Boot Mode”. Again, manufacturer specific. THIS MAY NOT BE AVAILABLE OR NECESSARY ON ALL SYSTEMS.</em></p>  </li>  <li>Save these changes and restart the system.</li>  <li>Boot to the USB drive. If possible, you can access the boot menu during startup similarly to the BIOS menu. However, you can also go back to the BIOS menu and change the boot sequence to make the UEFI USB Drive the first device the system boots to upon startup. You will now be able to boot to the USB.</li></ol><h2 id=\"5-resetting-the-adapter\">5. Resetting the Adapter</h2><ol>  <li>You should find yourself at a <code class=\"language-plaintext highlighter-rouge\">Shell&gt;</code> command line prompt. If you are experienced with using the terminal or are adventerous, here are some interesting <a href=\"https://www.sys-hint.com/3893-How-to-Use-UEFI-Interactive-Shell-and-Its-Common-Commands\">commands</a> you can play around with while in this shell.</li>  <li>Now, to find all available drives on the system, type <code class=\"language-plaintext highlighter-rouge\">map</code>. This may already show up when you are first brought into the shell.</li>  <li>Your USB drive should be named something along the lines of “Removable Hard Disk”. If not, choose the first drive that shows up first. Mount to the alias of that drive. For example, if the drive is named <code class=\"language-plaintext highlighter-rouge\">fs0</code>, type <code class=\"language-plaintext highlighter-rouge\">fs0:</code> (remember the colon). Your terminal prompt should now read <code class=\"language-plaintext highlighter-rouge\">fs0:\\&gt;</code> as you have successfully mounted the drive.</li>  <li>Type <code class=\"language-plaintext highlighter-rouge\">dir</code> to see the filesystem on that drive (Equivalent of using <code class=\"language-plaintext highlighter-rouge\">ls</code> in Linux.). If you do not see the files you put on the USB drive, retry the previous commands beginning with <code class=\"language-plaintext highlighter-rouge\">map</code> until you find the correct drive.</li>  <li>    <p>Type: <code class=\"language-plaintext highlighter-rouge\">sas3flash.efi -list</code></p>    <p>    - This shows the SAS Address as mentioned earlier. Record the SAS Address if you haven’t already.</p>    <p><strong>You may get an error stating “Controller is not operational. A firmware download is required.” Type <code class=\"language-plaintext highlighter-rouge\">quit</code> to exit that prompt and continue with this guide.</strong></p>    <p> <img src=\"/assets/images/list.png\" alt=\"List\" /></p>  </li>  <li>    <p>Type this command: <code class=\"language-plaintext highlighter-rouge\">sas3flash.efi -f SAS9300_8i_IT.bin -noreset</code>. After it completes, power down the system and take the jumper pin off of the RAID controller.<br />    - This erases the running flash/BIOS on the RAID controller.</p>    <p>  <img src=\"/assets/images/noreset.jpg\" alt=\"Noreset\" /></p>  </li></ol><h2 id=\"6-flashing-the-controller\">6. Flashing the Controller</h2><ol>  <li>Boot back into the UEFI shell through the USB drive.</li>  <li>Type this command: <code class=\"language-plaintext highlighter-rouge\">sas3flash.efi -o -e 7</code>    <ul>      <li>Erases the card’s NVRAM</li>    </ul>    <p> <img src=\"/assets/images/erase.jpg\" alt=\"Erase\" /></p>  </li>  <li>Next, type: <code class=\"language-plaintext highlighter-rouge\">sas3flash.efi -f SAS9300_8i_IT.bin -b mptsas3.rom -b mpt3x64.rom</code>    <ul>      <li>This flashes the new UEFI and Legacy BIOS firmware with ROM</li>    </ul>    <p> <img src=\"/assets/images/flash.jpg\" alt=\"Flash Firmware\" /></p>  </li>  <li>Type: <code class=\"language-plaintext highlighter-rouge\">sas3flash.efi -o -sasadd XXXXXXXXXXXXXXXXX</code>    <ul>      <li>Here, replace the X’s with your SAS Address. DO NOT USE HYPENS, SPACES, ETC.</li>      <li>This  flashes the SAS Address back onto the HBA</li>    </ul>    <p> <img src=\"/assets/images/sasadd.jpg\" alt=\"SASADD\" /></p>  </li>  <li>Lastly, type this command:<code class=\"language-plaintext highlighter-rouge\">sas3flash.efi -list</code>    <ul>      <li>Verify that all information including the SAS Address are correct.</li>    </ul>  </li></ol><h2 id=\"6-complete\">6. Complete!</h2><ul>  <li>You are now able to reboot the system and have completed this guide.<br />      - Command in UEFI shell: <code class=\"language-plaintext highlighter-rouge\">reset</code></li></ul><h1 id=\"resources\">Resources</h1><ul>  <li>MAIN TUTORIAL - <a href=\"https://www.servethehome.com/flash-lsi-sas-3008-hba-e-g-ibm-m1215-mode/\">How to flash a LSI SAS 3008 HBA (e.g. IBM M1215) to IT mode - ServeTheHome Forum</a></li>  <li><a href=\"https://forums.servethehome.com/index.php?threads/crossflashing-of-lsi-9341-8i-to-lsi-9300-8i-success-but-no-smart-pass-through.3522/\">Crossflashing of LSI 9341-8i to LSI 9300-8i - ServeTheHome Forum</a></li>  <li><a href=\"https://www.truenas.com/community/resources/detailed-newcomers-guide-to-crossflashing-lsi-9211-9300-9305-9311-9400-94xx-hba-and-variants.54/\">Detailed newcomers’ guide to crossflashing LSI 9211/9300/9305/9311/9400/94xx HBA and variants - TrueNAS Forum</a></li>  <li><a href=\"https://www.truenas.com/community/threads/how-to-flashing-lsi-sas-hba-controller-efi-uefi.78457/\">[HOW-TO] Flashing LSI SAS HBA Controller [EFI/UEFI] - TrueNAS Forum</a></li>  <li>Older Card Versions - <a href=\"https://www.servethehome.com/lsi-sas-2008-raid-controller-hba-information/\">LSI SAS 2008 RAID Controller/HBA Information - ServeTheHome Forum</a></li></ul>",
            "url": "http://localhost:4000/2024/01/11/flash-9300-8i-raid-controller-to-it-mode",
            
            
            
            
            
            "date_published": "2024-01-11T00:00:00-05:00",
            "date_modified": "2024-01-11T00:00:00-05:00",
            
                "author":  {
                "name": "Malachi",
                "url": null,
                "avatar": null
                }
                
            
        }
    
    ]
}